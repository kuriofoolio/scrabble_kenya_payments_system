<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrabble Kenya Tournament - Register Players</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');

:root {
  --primary: #E50914;
  --primary-dark: #B81D24;
  --secondary: #221F1F;
  --light: #F5F5F1;
  --gray: #EFEFEF;
  --dark: #121212;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Montserrat', sans-serif;
}

        body {
          background-color: var(--dark);
          color: var(--light);
        }

        .hero {
          background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)),
          url('/api/placeholder/1920/1080') center/cover no-repeat;
        height: 60vh;
        position: relative;
        }

        .navbar {
          background-color: rgba(18, 18, 18, 0.9);
          backdrop-filter: blur(5px);
        }

        .btn-primary {
          background-color: var(--primary);
          color: white;
          transition: all 0.3s ease;
        }

        .btn-primary:hover {
          background-color: var(--primary-dark);
          transform: translateY(-2px);
        }

        .division-card {
          transition: all 0.3s ease;
          border-radius: 8px;
          overflow: hidden;
          background-color: #1a1a1a;
          border: 1px solid #333;
        }

        .division-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 25px rgba(229, 9, 20, 0.2);
        }

        .player-card {
          transition: all 0.3s ease;
          border-radius: 8px;
          background-color: #1a1a1a;
          border: 1px solid #333;
          cursor: pointer;
        }

        .player-card:hover {
          border-color: var(--primary);
        }

        .player-card.selected {
          border-color: var(--primary);
          background-color: rgba(229, 9, 20, 0.1);
        }

        .modal {
          display: none;
          position: fixed;
          z-index: 50;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgba(0, 0, 0, 0.8);
          opacity: 0;
          transition: opacity 0.3s ease;
        }

        .modal.show {
          display: block;
          opacity: 1;
        }

        .modal-content {
          background-color: #1a1a1a;
          border-radius: 12px;
          border: 1px solid #333;
          width: 90%;
          max-width: 800px;
          margin: 5% auto;
          transform: translateY(-50px);
          transition: transform 0.4s ease;
          box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
          max-height: 90vh;
          overflow-y: auto;
        }

        .modal.show .modal-content {
          transform: translateY(0);
        }

        .toast-container {
          position: fixed;
          bottom: 20px;
          right: 20px;
          z-index: 1000;
        }

        .toast {
          transition: all 0.3s ease;
        }

        .loading-dots span {
          animation: loading 1.4s infinite ease-in-out both;
        }

        .loading-dots span:nth-child(1) {
          animation-delay: -0.32s;
        }

        .loading-dots span:nth-child(2) {
          animation-delay: -0.16s;
        }

        @keyframes loading {
          0%, 80%, 100% { transform: scale(0); }
          40% { transform: scale(1.0); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
          width: 8px;
        }

        ::-webkit-scrollbar-track {
          background: #222;
        }

        ::-webkit-scrollbar-thumb {
          background: #555;
          border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
          background: #777;
        }

        /* Section transitions */
        .section {
          opacity: 0;
          transform: translateY(20px);
          transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .section.visible {
          opacity: 1;
          transform: translateY(0);
        }

        /* Price tag styles */
        .price-tag {
          background-color: var(--primary);
          color: white;
          font-weight: bold;
          border-radius: 20px;
          padding: 0.25rem 0.75rem;
          position: absolute;
          top: 10px;
          right: 10px;
          font-size: 0.9rem;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .rating-badge {
          background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
          color: white;
          font-weight: bold;
          border-radius: 50px;
          padding: 0.25rem 0.75rem;
          font-size: 0.8rem;
          position: absolute;
          top: 10px;
          left: 10px;
        }

        /* Footer styling */
        footer {
          background-color: rgba(18, 18, 18, 0.95);
          border-top: 1px solid #333;
        }

        .selected-players-summary {
          background-color: rgba(229, 9, 20, 0.1);
          border: 1px solid var(--primary);
          border-radius: 8px;
          padding: 1rem;
          margin-top: 1rem;
        }
    </style>
  </head>
  <body>
    <!-- Toast Notifications Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Navigation Bar -->
    <nav class="navbar fixed top-0 w-full z-10 py-3 px-4 md:px-6">
      <div class="max-w-7xl mx-auto flex justify-between items-center">
        <a href="/" class="flex items-center">
          <span class="text-primary text-2xl font-bold tracking-tight text-red-600">S<span class="text-white">K</span></span>
        </a>
        <div class="hidden md:flex space-x-8">
          <a href="/" class="text-white hover:text-red-500 transition-colors duration-300">Home</a>
          <a href="/#divisions" class="text-white hover:text-red-500 transition-colors duration-300">Divisions</a>
          <a href="/#divisions" class="text-white hover:text-red-500 transition-colors duration-300">Register</a>
          <a href="/#contact" class="text-white hover:text-red-500 transition-colors duration-300">Contact</a>
        </div>
        <button id="mobile-menu-button" class="md:hidden text-white">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden md:hidden absolute top-16 left-0 right-0 bg-gray-900 shadow-lg rounded-b-lg overflow-hidden transition-all duration-300">
        <div class="px-4 py-2">
          <a href="#" class="block py-3 text-white hover:text-red-500 transition-colors duration-300">Home</a>
          <a href="#divisions" class="block py-3 text-white hover:text-red-500 transition-colors duration-300">Divisions</a>
          <a href="#" class="block py-3 text-white hover:text-red-500 transition-colors duration-300">Register</a>
          <a href="#" class="block py-3 text-white hover:text-red-500 transition-colors duration-300">Contact</a>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero flex items-center justify-center px-4">
      <div class="text-center max-w-4xl">
        <h1 class="text-4xl md:text-6xl font-bold mb-4 leading-tight">Register Players For <span class="text-red-600">Epic Tournaments</span></h1>
        <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">Choose your division and register players for upcoming tournaments. Join the competition and showcase your skills!</p>
        <a href="#divisions" class="btn-primary px-8 py-3 rounded-full font-medium text-lg inline-block">Register Now</a>
      </div>
    </section>

    <!-- Divisions Section -->
    <section id="divisions" class="py-16 px-4 md:px-8 max-w-7xl mx-auto section">
      <div class="mb-12 text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Tournament Divisions</h2>
        <p class="text-gray-400 max-w-2xl mx-auto">Select a division to view available players and register them for the tournament. Each division has specific rating requirements.</p>
      </div>

      <div id="divisions-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Division cards will be populated dynamically -->
        <div class="text-center col-span-full">
          <div class="inline-block mx-auto">
            <div class="loading-dots flex space-x-2">
              <span class="w-3 h-3 bg-red-600 rounded-full"></span>
              <span class="w-3 h-3 bg-red-600 rounded-full"></span>
              <span class="w-3 h-3 bg-red-600 rounded-full"></span>
            </div>
          </div>
          <p class="mt-4 text-gray-400">Loading divisions...</p>
        </div>
      </div>
    </section>

    <!-- Registration Modal -->
    <div id="registration-modal" class="modal">
      <div class="modal-content p-6">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold">Register Players</h3>
          <button id="close-modal" class="text-gray-400 hover:text-white">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- Customer Information -->
        <form id="registration-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="customer-name" class="block text-sm font-medium text-gray-400 mb-1">Your Name</label>
              <input type="text" id="customer-name" name="customerName" class="w-full px-4 py-2 rounded-md bg-gray-800 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
            </div>

            <div>
              <label for="phone-number" class="block text-sm font-medium text-gray-400 mb-1">Phone Number</label>
              <input type="tel" id="phone-number" name="phoneNumber" placeholder="e.g. 0712345678" class="w-full px-4 py-2 rounded-md bg-gray-800 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
            </div>
          </div>

          <!-- Available Players -->
          <div>
            <h4 class="text-lg font-medium mb-4">Select Players to Register</h4>
            
            <!-- Search Input -->
            <div class="mb-4">
              <div class="relative">
                <input 
                  type="text" 
                  id="player-search" 
                  placeholder="Search players by name..." 
                  class="w-full px-4 py-2 pl-10 rounded-md bg-gray-800 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
                >
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                </div>
                <button 
                  id="clear-search" 
                  class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white hidden"
                >
                  <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            </div>

            <div id="players-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
              <!-- Players will be populated here -->
            </div>

            <!-- No Results Message -->
            <div id="no-results" class="hidden text-center py-8 text-gray-400">
              <svg class="mx-auto h-12 w-12 text-gray-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.137 0-4.146-.832-5.636-2.364M6 20.291A7.962 7.962 0 0112 24a7.962 7.962 0 016-2.709M6 3.709A7.962 7.962 0 0112 0c2.137 0 4.146.832 5.636 2.364M18 3.709A7.962 7.962 0 0012 0 7.962 7.962 0 006 3.709" />
              </svg>
              <p class="text-lg font-medium">No players found</p>
              <p class="text-sm">Try adjusting your search terms</p>
            </div>
          </div>

          <!-- Selected Players Summary -->
          <div id="selected-summary" class="hidden selected-players-summary">
            <h4 class="font-medium mb-2">Selected Players</h4>
            <div id="selected-players-list"></div>
            <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-600">
              <span class="font-medium">Total Amount</span>
              <span id="total-amount" class="text-xl font-bold text-red-500">KSh 0</span>
            </div>
          </div>

          <div class="flex space-x-4">
            <button type="submit" id="submit-registration" class="flex-1 btn-primary py-3 rounded-md font-medium">
              Register Players
            </button>

            <button type="button" id="loading-button" class="hidden flex-1 bg-gray-700 py-3 rounded-md font-medium text-gray-300 cursor-not-allowed" disabled>
              <div class="flex justify-center items-center">
                <div class="loading-dots flex space-x-2 items-center">
                  <span class="w-2 h-2 bg-gray-300 rounded-full"></span>
                  <span class="w-2 h-2 bg-gray-300 rounded-full"></span>
                  <span class="w-2 h-2 bg-gray-300 rounded-full"></span>
                </div>
                <span class="ml-2">Processing Payment...</span>
              </div>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- About Section -->
    <section id="about-us" class="py-16 px-4 md:px-8 bg-gray-900 section">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row items-center">
          <div class="md:w-1/2 mb-8 md:mb-0 md:pr-8">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">Join the Ultimate Gaming Tournament</h2>
            <p class="text-gray-400 mb-6">Compete with players from around the region in our professionally organized tournaments. Each division is carefully structured to ensure fair and competitive gameplay.</p>
            <ul class="space-y-3">
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mt-1 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <span>Multiple divisions based on skill rating</span>
              </li>
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mt-1 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <span>Professional tournament organization</span>
              </li>
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mt-1 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <span>Exciting prizes and recognition</span>
              </li>
            </ul>
          </div>
          <div class="md:w-1/2">
            <div class="rounded-lg overflow-hidden shadow-xl">
              <img src="/api/placeholder/600/400" alt="Gaming Tournament" class="w-full">
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 px-4 md:px-8">
      <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <h4 class="text-xl font-bold mb-4">Scrabble Kenya</h4>
            <p class="text-gray-400 mb-4">The ultimate destination for competitive gaming tournaments with professional organization and exciting prizes.</p>
            <div class="flex space-x-4">
              <a title="Facebook" href="https://www.facebook.com/groups/Scrabblekenya/" class="text-gray-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0h-21.35c-.732 0-1.325.593-1.325 1.325v21.351c0 .731.593 1.324 1.325 1.324h11.495v-9.294h-3.128v-3.622h3.128v-2.671c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12v9.293h6.116c.73 0 1.323-.593 1.323-1.325v-21.35c0-.732-.593-1.325-1.325-1.325z"/></svg>
              </a>
              <a title="X" href="https://twitter.com/kenya_scrabble?lang=en" class="text-gray-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723 10.059 10.059 0 01-3.127 1.184 4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
              </a>
              <a title="Instagram" href="https://www.instagram.com/scrabble.kenya/" class="text-gray-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/></svg>
              </a>
            </div>
          </div>
          <div>
            <h4 class="text-lg font-bold mb-4">Quick Links</h4>
            <ul class="space-y-2">
              <li><a href="https://scrabblekenya.com/" class="text-gray-400 hover:text-white transition-colors">Home</a></li>
              <li><a href="/#divisions" class="text-gray-400 hover:text-white transition-colors">Divisions</a></li>
              <li><a href="/#about-us" class="text-gray-400 hover:text-white transition-colors">About Us</a></li>
              <li><a href="/#contact" class="text-gray-400 hover:text-white transition-colors">Contact</a></li>
              <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Terms & Conditions</a></li>
            </ul>
          </div>
          <div>
            <h4 id="contact" class="text-lg font-bold mb-4">Contact Us</h4>
            <address class="not-italic text-gray-400">
              <p class="mb-2">P.O.BOX 22388 - 00100</p>
              <p class="mb-2">Nairobi, Kenya</p>
              <p class="mb-2">info@Scrabble Kenya.com</p>
              <p>+254714666212, +254725037750</p>
            </address>
          </div>
        </div>
        <div class="mt-12 pt-8 border-t border-gray-800 text-center text-gray-500">
          <p>&copy; 2025 Scrabble Kenya. All Rights Reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Elements
        const divisionsContainer = document.getElementById('divisions-container');
        const registrationModal = document.getElementById('registration-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const registrationForm = document.getElementById('registration-form');
        const playersContainer = document.getElementById('players-container');
        const selectedSummary = document.getElementById('selected-summary');
        const selectedPlayersList = document.getElementById('selected-players-list');
        const totalAmountEl = document.getElementById('total-amount');
        const submitRegistrationBtn = document.getElementById('submit-registration');
        const loadingButton = document.getElementById('loading-button');
        const toastContainer = document.getElementById('toast-container');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const phoneInput = document.getElementById('phone-number');

        // Search elements
        const playerSearchInput = document.getElementById('player-search');
        const clearSearchBtn = document.getElementById('clear-search');
        const noResultsDiv = document.getElementById('no-results');

        // State
        let divisions = [];
        let players = [];
        let filteredPlayers = []; // For search functionality
        let selectedPlayers = new Map(); // Map of playerId -> {player, divisionId}

        // Sections animation
        const sections = document.querySelectorAll('.section');

        function checkSections() {
          const triggerBottom = window.innerHeight * 0.8;

          sections.forEach(section => {
            const sectionTop = section.getBoundingClientRect().top;
            if (sectionTop < triggerBottom) {
              section.classList.add('visible');
            }
          });
        }

        window.addEventListener('scroll', checkSections);
        checkSections(); // Check on load

        // Mobile menu toggle
        mobileMenuButton.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
        });

        // Toast notification system
        function createToast(message, type = 'error') {
          const toast = document.createElement('div');
          toast.className = `mb-4 p-4 rounded-lg shadow-lg transform transition-all duration-300 ease-in-out toast ${
            type === 'error' ? 'bg-red-900 border-red-700 text-red-100' : 'bg-green-900 border-green-700 text-green-100'
          }`;

          toast.innerHTML = `
            <div class="flex items-center">
            <div class="flex-shrink-0">
            ${type === 'error' ?
                '<svg class="h-5 w-5 text-red-300" viewBox="0 0 20 20" fill="currentColor"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/></svg>' :
              '<svg class="h-5 w-5 text-green-300" viewBox="0 0 20 20" fill="currentColor"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg>'
            }
            </div>
            <div class="ml-3">
            <p class="text-sm font-medium">${message}</p>
            </div>
            <div class="ml-auto pl-3">
            <button class="inline-flex text-gray-400 hover:text-white focus:outline-none">
            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
            </svg>
            </button>
            </div>
            </div>
          `;

          // Add click event to close button
          toast.querySelector('button').addEventListener('click', function() {
            toast.classList.add('opacity-0');
            setTimeout(() => toast.remove(), 300);
          });

        toastContainer.appendChild(toast);

        // Auto-remove toast after 5 seconds
        setTimeout(() => {
          toast.classList.add('opacity-0');
          setTimeout(() => toast.remove(), 300);
        }, 5000);
      }

        // Phone number formatting and validation
        function formatPhoneNumber(phone) {
          // Remove any non-digit characters
          phone = phone.replace(/\D/g, '');

          // Handle different formats
          if (phone.startsWith('254')) {
            return phone;
          } else if (phone.startsWith('0')) {
            return '254' + phone.slice(1);
          } else if (phone.startsWith('+254')) {
            return phone.slice(1);
          }

          return phone;
        }

        function validatePhone(phone) {
          const regex = /^254[17][0-9]{8}$/;
          return regex.test(phone);
        }

        // Real-time phone number formatting
        phoneInput.addEventListener('input', function(e) {
          let formattedNumber = formatPhoneNumber(e.target.value);
          e.target.value = formattedNumber;
        });

        // Search functionality
        playerSearchInput.addEventListener('input', function(e) {
          const searchTerm = e.target.value.trim();
          
          // Show/hide clear button
          if (searchTerm) {
            clearSearchBtn.classList.remove('hidden');
          } else {
            clearSearchBtn.classList.add('hidden');
          }
          
          // Filter players
          filterPlayers(searchTerm);
        });

        // Clear search functionality
        clearSearchBtn.addEventListener('click', function() {
          playerSearchInput.value = '';
          clearSearchBtn.classList.add('hidden');
          filterPlayers(''); // Show all players
        });

        // Filter players based on search term
        function filterPlayers(searchTerm) {
          if (!searchTerm) {
            // Show all players
            filteredPlayers = [...players];
          } else {
            // Filter players by name (case-insensitive)
            filteredPlayers = players.filter(player => 
              player.playerName.toLowerCase().includes(searchTerm.toLowerCase())
            );
          }
          
          // Re-render the filtered players
          renderFilteredPlayers();
        }

        // Fetch divisions and players from API
        async function fetchData() {
          try {
            const response = await fetch('/api/purchase-ticket');
            if (!response.ok) {
              throw new Error('Failed to fetch data');
            }

            const data = await response.json();

            // Store data
            players = data.players || [];
            divisions = data.divisions || [];

            // Clear loading state
            divisionsContainer.innerHTML = '';

            // Check if divisions exist
            if (divisions.length > 0) {
              // Render divisions
              divisions.forEach(division => {
                const divisionCard = createDivisionCard(division);
                divisionsContainer.appendChild(divisionCard);
              });
            } else {
              divisionsContainer.innerHTML = '<div class="text-center col-span-full"><p class="text-gray-400">No divisions available at the moment.</p></div>';
            }
          } catch (error) {
            console.error('Error:', error);
            divisionsContainer.innerHTML = '<div class="text-center col-span-full"><p class="text-red-400">Failed to load divisions. Please try again later.</p></div>';
            createToast('Failed to load divisions. Please try again later.', 'error');
          }
        }

        // Create division card element
        function createDivisionCard(division) {
          const cardDiv = document.createElement('div');
          cardDiv.className = 'division-card';
          cardDiv.innerHTML = `
            <div class="p-6">
              <div class="flex justify-between items-start mb-4">
                <h3 class="text-xl font-bold">${division.title}</h3>
                <div class="price-tag">KSh ${division.price}</div>
              </div>
              <p class="text-gray-400 mb-4">${division.description || 'Tournament division'}</p>
              <div class="mb-4">
                <p class="text-sm text-gray-500 mb-1">Rating Range</p>
                <p class="font-medium">${division.minRating} - ${division.maxRating}</p>
              </div>
              <div class="mb-6">
                <p class="text-sm text-gray-500 mb-1">Available Players</p>
                <p class="font-medium">${getEligiblePlayersCount(division)} players eligible</p>
              </div>
              <button class="register-division-btn w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-md transition-colors duration-300"
                      data-division-id="${division.divisionId}">
                Register Players
              </button>
            </div>
          `;

          // Add event listener to the register button
          const registerBtn = cardDiv.querySelector('.register-division-btn');
          registerBtn.addEventListener('click', () => {
            openRegistrationModal(division);
          });

          return cardDiv;
        }

        // Get count of eligible players for a division
        function getEligiblePlayersCount(division) {
          return players.filter(player => 
            player.playerRating >= division.minRating && 
            player.playerRating <= division.maxRating
          ).length;
        }

        // Function to open registration modal
        function openRegistrationModal(selectedDivision = null) {
          // Reset form
          registrationForm.reset();
          selectedPlayers.clear();
          updateSelectedSummary();

          // Reset search
          playerSearchInput.value = '';
          clearSearchBtn.classList.add('hidden');

          // Show available players
          renderAvailablePlayers(selectedDivision);

          // Show modal
          registrationModal.classList.add('show');
          document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        // Render available players
        function renderAvailablePlayers(selectedDivision = null) {
          if (players.length === 0) {
            playersContainer.innerHTML = '<div class="col-span-full text-center text-gray-400">No players available for registration.</div>';
            noResultsDiv.classList.add('hidden');
            return;
          }

          // Initialize filtered players with all players
          filteredPlayers = [...players];
          renderFilteredPlayers(selectedDivision);
        }

        // Render filtered players (used by both initial load and search)
        function renderFilteredPlayers(selectedDivision = null) {
          playersContainer.innerHTML = '';

          if (filteredPlayers.length === 0) {
            // Show no results message
            playersContainer.classList.add('hidden');
            noResultsDiv.classList.remove('hidden');
            return;
          }

          // Hide no results message and show container
          playersContainer.classList.remove('hidden');
          noResultsDiv.classList.add('hidden');

          filteredPlayers.forEach(player => {
            const playerCard = createPlayerCard(player, selectedDivision);
            playersContainer.appendChild(playerCard);
          });
        }

        // Create player card element
        function createPlayerCard(player, selectedDivision = null) {
          // Find eligible divisions for this player
          const eligibleDivisions = divisions.filter(division =>
            player.playerRating >= division.minRating && player.playerRating <= division.maxRating
          );

          const cardDiv = document.createElement('div');
          cardDiv.className = 'player-card p-4 relative';
          cardDiv.innerHTML = `
            <div class="rating-badge">${player.playerRating}</div>
            <div class="mt-8">
              <h4 class="font-bold text-lg mb-2">${player.playerName}</h4>
              <p class="text-sm text-gray-400 mb-3">Rating: ${player.playerRating}</p>
              ${player.playerEmail ? `<p class="text-xs text-gray-500 mb-3">${player.playerEmail}</p>` : ''}
              <div class="mb-3">
                <p class="text-xs text-gray-500 mb-1">Eligible Divisions:</p>
                <div class="space-y-1">
                  ${eligibleDivisions.map(division => `
                    <label class="flex items-center text-sm">
                      <input type="radio" name="division_${player.playerId}" value="${division.divisionId}" 
                             class="mr-2" ${selectedDivision && selectedDivision.divisionId === division.divisionId ? 'checked' : ''}>
                      <span>${division.title} (KSh ${division.price})</span>
                    </label>
                  `).join('')}
                </div>
              </div>
              <button type="button" class="select-player-btn w-full py-2 px-4 rounded text-sm border border-gray-600 hover:border-red-500 transition-colors"
                      data-player-id="${player.playerId}">
                Select Player
              </button>
            </div>
          `;

          // Add event listener to select button
          const selectBtn = cardDiv.querySelector('.select-player-btn');
          selectBtn.addEventListener('click', () => {
            togglePlayerSelection(player, cardDiv);
          });

          return cardDiv;
        }

        // Toggle player selection
        function togglePlayerSelection(player, cardElement) {
          const playerId = player.playerId;
          const selectBtn = cardElement.querySelector('.select-player-btn');
          const divisionRadios = cardElement.querySelectorAll(`input[name="division_${playerId}"]`);
          
          if (selectedPlayers.has(playerId)) {
            // Deselect player
            selectedPlayers.delete(playerId);
            cardElement.classList.remove('selected');
            selectBtn.textContent = 'Select Player';
            selectBtn.classList.remove('bg-red-600', 'text-white');
            selectBtn.classList.add('border-gray-600');
          } else {
            // Check if a division is selected
            const selectedDivision = Array.from(divisionRadios).find(radio => radio.checked);
            if (!selectedDivision) {
              createToast('Please select a division for this player first.', 'error');
              return;
            }

            // Select player
            const divisionId = parseInt(selectedDivision.value);
            selectedPlayers.set(playerId, {
              player: player,
              divisionId: divisionId,
              division: divisions.find(d => d.divisionId === divisionId)
            });
            
            cardElement.classList.add('selected');
            selectBtn.textContent = 'Selected';
            selectBtn.classList.add('bg-red-600', 'text-white');
            selectBtn.classList.remove('border-gray-600');
          }

          updateSelectedSummary();
        }

        // Update selected players summary
        function updateSelectedSummary() {
          if (selectedPlayers.size === 0) {
            selectedSummary.classList.add('hidden');
            return;
          }

          selectedSummary.classList.remove('hidden');
          
          let totalAmount = 0;
          let summaryHTML = '';

          selectedPlayers.forEach(({player, division}) => {
            totalAmount += parseFloat(division.price);
            summaryHTML += `
              <div class="flex justify-between items-center py-2 border-b border-gray-600 last:border-b-0">
                <div>
                  <span class="font-medium">${player.playerName}</span>
                  <span class="text-sm text-gray-400 ml-2">(Rating: ${player.playerRating})</span>
                </div>
                <div class="text-right">
                  <div class="text-sm text-gray-400">${division.title}</div>
                  <div class="font-medium">KSh ${division.price}</div>
                </div>
              </div>
            `;
          });

          selectedPlayersList.innerHTML = summaryHTML;
          totalAmountEl.textContent = `KSh ${totalAmount}`;
        }

        // Close modal
        closeModalBtn.addEventListener('click', () => {
          registrationModal.classList.remove('show');
          document.body.style.overflow = ''; // Allow scrolling again
        });

        // Close modal when clicking outside
        registrationModal.addEventListener('click', (e) => {
          if (e.target === registrationModal) {
            registrationModal.classList.remove('show');
            document.body.style.overflow = ''; // Allow scrolling again
          }
        });

        // Handle form submission
        registrationForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          if (selectedPlayers.size === 0) {
            createToast('Please select at least one player to register.', 'error');
            return;
          }

          // Validate phone number
          const phoneNumber = formatPhoneNumber(phoneInput.value.trim());
          if (!validatePhone(phoneNumber)) {
            createToast('Please enter a valid phone number (e.g., 0712345678)', 'error');
            return;
          }

          // Prepare payload
          const playersArray = Array.from(selectedPlayers.values()).map(({player, divisionId}) => ({
            playerId: player.playerId,
            divisionId: divisionId
          }));

          const payload = {
            players: playersArray,
            customerName: document.getElementById('customer-name').value.trim(),
            phoneNumber: phoneNumber
          };

          // Show loading state
          submitRegistrationBtn.classList.add('hidden');
          loadingButton.classList.remove('hidden');

          try {
            // Send API request
            const response = await fetch('/api/make-payment', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(payload)
            });

            const data = await response.json();

            if (response.ok) {
              // If the payment was initiated successfully
              createToast('Payment initiated successfully. Please check your phone to complete the transaction.', 'success');

              // Start checking status
              if (data.checkoutRequestId) {
                checkPaymentStatus(data.checkoutRequestId, data.paymentId);
              }
            } else {
              // If there was an error
              createToast(data.error || 'Failed to process payment. Please try again.', 'error');
              submitRegistrationBtn.classList.remove('hidden');
              loadingButton.classList.add('hidden');
            }
          } catch (error) {
            console.error('Error:', error);
            createToast('An error occurred. Please try again later.', 'error');
            submitRegistrationBtn.classList.remove('hidden');
            loadingButton.classList.add('hidden');
          }
        });

        // Function to check payment status
        function checkPaymentStatus(checkoutRequestId, paymentId) {
          function queryStatus() {
            return fetch('/api/query-payment-status', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ checkoutRequestId })
            });
          }

          function processStatus(statusData) {
            if (statusData.errorCode) {
              // Payment failed or still pending
              if (statusData.errorCode === "500.001.1001") {
                // Still waiting for payment (transaction in progress)
                // Continue polling
                return new Promise(resolve => setTimeout(resolve, 5000))
                  .then(queryStatus)
                  .then(response => response.json())
                  .then(processStatus)
                  .catch(error => {
                    createToast('An unexpected error occurred while checking payment status', 'error');
                    submitRegistrationBtn.classList.remove('hidden');
                    loadingButton.classList.add('hidden');
                  });
              } else {
                // Payment failed with a specific error
                createToast('Payment failed: ' + (statusData.errorMessage || 'Unknown error'), 'error');
                submitRegistrationBtn.classList.remove('hidden');
                loadingButton.classList.add('hidden');
              }
            } else if (statusData.ResultCode === "0") {
              // Payment successful
              createToast('Payment successful! Players have been registered.', 'success');
              // Close modal and reset form
              registrationModal.classList.remove('show');
              document.body.style.overflow = ''; // Allow scrolling again

              // Refresh the page to show updated data
              setTimeout(() => {
                window.location.reload();
              }, 2000);
            } else {
              // Continue polling until we get a definitive status
              return new Promise(resolve => setTimeout(resolve, 5000))
                .then(queryStatus)
                .then(response => response.json())
                .then(processStatus)
                .catch(error => {
                  createToast('An unexpected error occurred while checking payment status', 'error');
                  submitRegistrationBtn.classList.remove('hidden');
                  loadingButton.classList.add('hidden');
                });
            }
          }

          // Start the status checking process
          return queryStatus()
            .then(response => response.json())
            .then(processStatus)
            .catch(error => {
              createToast('An unexpected error occurred while checking payment status', 'error');
              submitRegistrationBtn.classList.remove('hidden');
              loadingButton.classList.add('hidden');
            });
        }

        // Initialize
        fetchData();
      });
    </script>
  </body>
</html>